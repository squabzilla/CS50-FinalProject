{% extends "layout.html" %}

{% block title %}Character Creator{% endblock %}

{% block header %}Character Creator{% endblock %}

{% block main %}
    <p>This is the character creator.</p>
    
    {% if not new_pc.has_name %}
        <p> We need a name </p>
        <form action="/character_creator" method="POST" class="form-control mx-auto w-auto">
            <input autocomplete="off" autofocus class="form-control w-auto" id="character_name" name="character_name" placeholder="Character Name" type="text" value="Bob" required="required">
            <button class="btn btn-primary" type="submit">Submit</button>
        </form>

    {% elif not new_pc.has_race %}
        <p> We need a race </p>
        <form action="/character_creator" method="POST" class="form-control mx-auto w-auto">
            <select class="form-select" class="form-control w-auto" aria-label="Default select example" name="race_id" id="race_id">
            </select>
            <button class="btn btn-primary" type="submit">Submit</button>
        </form>
        <script type="module">
            //const json_dump_races = JSON.parse({{json_dump|tojson}});
            
            /*
            const race_query_response = await fetch("/get_races");
            //const json_dump_races = await race_query_response.json();
            const json_dump_races = await race_query_response;
            console.log(json_dump_races)
            */
            
            let race_response = await fetch('/get_race_dropdown');
            let race_dropdown = await race_response.json();
            //let race_dropdown = await race_response;
            console.log(race_dropdown)
            document.getElementById("race_id").insertAdjacentHTML("beforeend",race_dropdown)
            /*
            let race_response = await fetch('/get_races');
            let race_list = await race_response.json();
            console.log(race_list)
            for (let i = 0; i < race_list.length; i++) {
                let race_dropdown = "<option value=\"" + race_list[i]["race_id"] + "\">" + race_list[i]["race_name"] + "</option>"
                document.getElementById("race_id").insertAdjacentHTML("beforeend",race_dropdown)
            }
            */
            
            /*
            //console.log(json_dump_races);
            for (let i = 0; i < json_dump_races.length; i++) {
                let race_dropdown = "<option value=\"" + json_dump_races[i]["race_id"] + "\">" + json_dump_races[i]["race_name"] + "</option>"
                document.getElementById("race_id").insertAdjacentHTML("beforeend",race_dropdown)
            }*/
        </script>

    {% elif not new_pc.has_class %}
        <p> We need a class </p>
        <form action="/character_creator" method="POST" class="form-control mx-auto w-auto">
            <select class="form-select" class="form-control w-auto" aria-label="Default select example" name="class_id" id="class_id">
            </select>
            <button class="btn btn-primary" type="submit">Submit</button>
        </form>
        <script>
            /*
            const json_dump_classes = JSON.parse({{json_dump|tojson}});
            console.log(json_dump_classes);
            for (let i = 0; i < json_dump_classes.length; i++) {
                let class_dropdown = "<option value=\"" + json_dump_classes[i]["class_id"] + "\">" + json_dump_classes[i]["class_name"] + "</option>"
                document.getElementById("class_id").insertAdjacentHTML("beforeend",class_dropdown)
            }
            */
            let class_response = await fetch('/get_classes');
            let class_list = await class_response.json();
            console.log(class_list)
            for (let i = 0; i < class_list.length; i++) {
                let class_dropdown = "<option value=\"" + class_list[i]["class_id"] + "\">" + class_list[i]["class_name"] + "</option>"
                document.getElementById("class_id").insertAdjacentHTML("beforeend",class_dropdown)
            }
        </script>

    {% elif not new_pc.has_background %}
        <p> We need a background </p>
        <form action="/character_creator" method="POST" class="form-control mx-auto w-auto">
            <select class="form-select" class="form-control w-auto" aria-label="Default select example" name="background_id" id="background_id">
            </select>
            <button class="btn btn-primary" type="submit">Submit</button>
        </form>
        <script>
            const json_dump_backgrounds = JSON.parse({{json_dump|tojson}});
            console.log(json_dump_backgrounds);
            for (let i = 0; i < json_dump_backgrounds.length; i++) {
                let background_dropdown = "<option value=\"" + json_dump_backgrounds[i]["background_id"] + "\">" + json_dump_backgrounds[i]["background_name"] + "</option>"
                document.getElementById("background_id").insertAdjacentHTML("beforeend",background_dropdown)
            }
        </script>

    {% else %}
        <p>DONE!</p>

    {% endif %}

{% endblock %}

{% block footer %}{% endblock %}